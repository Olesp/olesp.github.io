<!doctype html><html><head><title>Lister tous les comptes de services sur votre compte AWS</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link rel=stylesheet href=/css/flag-icon.min.css><link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/images/olivier_hu0e6c1c8c6dc6b67478684e7b00b46b4a_53705_42x0_resize_q75_box.jpeg><meta property="og:title" content="Lister tous les comptes de services sur votre compte AWS"><meta property="og:description" content="Lister les comptes de service AWS"><meta property="og:type" content="article"><meta property="og:url" content="https://olivierlespagnon.com/fr/posts/tutorials/gathering-all-service-accounts-in-aws/gathering_svc_python/"><meta property="article:published_time" content="2022-06-05T08:06:25+06:00"><meta property="article:modified_time" content="2022-06-05T08:06:25+06:00"><meta name=description content="Lister les comptes de service AWS"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css><link rel=stylesheet href=/css/style.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/fr>Olivier Lespagnon</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=languageSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span class="flag-icon flag-icon-fr"></span>Français</a><div class=dropdown-menu aria-labelledby=languageSelector><a class="dropdown-item nav-link languages-item" href=/posts/tutorials/gathering-all-service-accounts-in-aws/gathering_svc_python><span class="flag-icon flag-icon-gb"></span>English</a></div></li></ul></div></div></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/fr/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/fr/posts data-filter=all>Articles</a></li><div class=subtree><li><i class="fas fa-plus-circle"></i><a href>soft</a><ul><li><a href=/fr/posts/soft-skills/learn-a-new-job/learn_for_a_new_position/ title="Comment se former lors de la prise d'un nouveau poste">Comment se former lors de la prise d'un nouveau poste</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href>tech</a><ul><li><a href=/fr/posts/r%C3%A9alisations-techniques/hashicorp-vault/hashicorp_vault/ title="Hashicorp Vault">Hashicorp Vault</a></li></ul></li><li><i class="fas fa-minus-circle"></i><a class=active href>tuto</a><ul class=active><li><a href=/fr/posts/tutorials/how-to-manage-your-infrastructure-using-terraform/terraform_infra/ title="Gérer votre infra avec Terraform">Gérer votre infra avec Terraform</a></li><li><a href=/fr/posts/tutorials/introduction-to-kubernetes/get_started_with_k8s/ title="Intro à K8S">Intro à K8S</a></li><li><a class=active href=/fr/posts/tutorials/gathering-all-service-accounts-in-aws/gathering_svc_python/ title="Lister les comptes de service AWS">Lister les comptes de service AWS</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(https://olivierlespagnon.com/images/default-hero.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/olivier_hu0e6c1c8c6dc6b67478684e7b00b46b4a_53705_120x120_fit_q75_box.jpeg alt="Author Image"><h5 class=author-name>Olivier Lespagnon</h5><p>June 5, 2022</p></div><div class=title><h1>Lister tous les comptes de services sur votre compte AWS</h1></div><div class=post-content id=post-content><p>La collecte de tous les comptes de services dans un compte AWS est une tâche importante pour toute organisation utilisant Amazon Web Services (AWS). Cette tâche consiste à récupérer des informations sur tous les services utilisés dans un compte AWS et à les regrouper en un seul endroit pour une meilleure gestion et surveillance. Cela peut être particulièrement utile pour les organisations qui ont plusieurs comptes AWS et souhaitent centraliser leur gestion et surveillance.</p><h2 id=pourquoi-collecter-tous-les-comptes-de-services-dans-un-compte-aws->Pourquoi collecter tous les comptes de services dans un compte AWS ?</h2><p>Il y a plusieurs avantages à collecter tous les comptes de services dans un compte AWS, notamment :</p><ul><li>Une visibilité améliorée : en regroupant tous les services en un seul endroit, les organisations peuvent mieux comprendre les services qu&rsquo;elles utilisent et comment ils sont utilisés. Cela aide à identifier les domaines où les services ne sont pas utilisés de manière efficace ou où il peut y avoir des opportunités d&rsquo;optimisation des coûts.</li><li>Une meilleure gestion des coûts : en ayant une vue claire de tous les services, les organisations peuvent mieux gérer leurs coûts en identifiant et en supprimant les services inutilisés ou en optimisant l&rsquo;utilisation des services existants.</li><li>Une sécurité améliorée : en ayant tous les services en un seul endroit, il est plus facile de les surveiller et de les sécuriser. Cela aide à identifier les risques potentiels de sécurité et à s&rsquo;assurer que tous les services sont utilisés de manière sécurisée et conforme.</li></ul><h2 id=comment-collecter-tous-les-comptes-de-services-dans-un-compte-aws-en-utilisant-python->Comment collecter tous les comptes de services dans un compte AWS en utilisant Python ?</h2><p>Il est possible de rassembler tous les comptes de service dans un compte AWS en utilisant la Console de gestion AWS ou la CLI AWS. Cependant, de nombreuses organisations préfèrent utiliser Python pour automatiser ce processus, car il offre une solution plus flexible et évolutive. Les étapes suivantes décrivent comment rassembler tous les comptes de service dans un compte AWS à l&rsquo;aide de Python. Dans cet exemple, nous considérons que chaque compte non utilisé par un humain ne contient pas d&rsquo;adresse email en tant que nom d&rsquo;utilisateur.</p><ol><li>Configurer un compte AWS: avant de pouvoir rassembler tous les services dans un compte AWS, vous devez disposer d&rsquo;un compte AWS. Si vous n&rsquo;en avez pas encore, vous pouvez vous inscrire pour un compte AWS sur le site web AWS.</li><li>Installer la CLI AWS et Python: pour rassembler tous les services dans un compte AWS, vous devez installer la CLI AWS et Python. La CLI AWS est un outil en ligne de commande qui vous permet d&rsquo;interagir avec les services AWS à partir de la ligne de commande, et Python est un langage de programmation de haut niveau largement utilisé pour les tâches d&rsquo;automatisation et de script.</li><li>Configurer la CLI AWS: après avoir installé la CLI AWS, vous devez la configurer avec vos informations d&rsquo;identification de compte AWS. Cela peut être fait en exécutant la commande &ldquo;aws configure&rdquo; et en fournissant votre ID de clé d&rsquo;accès AWS, votre clé secrète d&rsquo;accès AWS et votre région par défaut.</li><li>Installer la bibliothèque boto3: pour rassembler tous les services dans un compte AWS à l&rsquo;aide de Python, vous devez utiliser la bibliothèque boto3. Boto3 est le SDK AWS pour Python et vous permet d&rsquo;interagir avec les services AWS à partir de Python. Vous pouvez installer boto3 en exécutant la commande suivante: pip install boto3.</li><li>Écrire un script Python: après avoir installé boto3, vous êtes prêt à écrire un script Python pour rassembler tous les comptes de service dans votre compte AWS. Le script Python suivant récupère des informations sur tous les services dans un compte AWS et les imprime sur la console:</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>    <span style=color:#f92672>import</span> boto3
    <span style=color:#f92672>import</span> pandas <span style=color:#f92672>as</span> pd

    <span style=color:#75715e># Connect to AWS Organizations service</span>
    client <span style=color:#f92672>=</span> boto3<span style=color:#f92672>.</span>client(<span style=color:#e6db74>&#39;organizations&#39;</span>)

    <span style=color:#75715e># Get a list of all AWS accounts in the organization</span>
    response <span style=color:#f92672>=</span> client<span style=color:#f92672>.</span>list_accounts()
    accounts <span style=color:#f92672>=</span> response[<span style=color:#e6db74>&#39;Accounts&#39;</span>]

    <span style=color:#75715e># Filter out the accounts that do not have an email address as a username</span>
    filtered_accounts <span style=color:#f92672>=</span> []
    <span style=color:#66d9ef>for</span> account <span style=color:#f92672>in</span> accounts:
        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;@&#39;</span> <span style=color:#f92672>in</span> account[<span style=color:#e6db74>&#39;Account Name&#39;</span>]:
            filtered_accounts<span style=color:#f92672>.</span>append(account)

    <span style=color:#75715e># Initialize an empty Pandas dataframe to store the data for each account</span>
    data <span style=color:#f92672>=</span> []
    columns <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;Account Id&#39;</span>, <span style=color:#e6db74>&#39;Account Name&#39;</span>, <span style=color:#e6db74>&#39;Email&#39;</span>]
    <span style=color:#66d9ef>for</span> account <span style=color:#f92672>in</span> filtered_accounts:
        data<span style=color:#f92672>.</span>append([account[<span style=color:#e6db74>&#39;Id&#39;</span>], account[<span style=color:#e6db74>&#39;Name&#39;</span>], account[<span style=color:#e6db74>&#39;Email&#39;</span>]])

    df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame(data, columns<span style=color:#f92672>=</span>columns)

    <span style=color:#75715e># Save the results to an Excel file</span>
    df<span style=color:#f92672>.</span>to_excel(<span style=color:#e6db74>&#39;accounts.xlsx&#39;</span>, index<span style=color:#f92672>=</span>False)

</code></pre></div><p>Ce code vous permettera de sauvegarder toutes les informations des comptes ainsi trouvé et de les exporter dans un fichier excel pour un futur reporting.</p></div><div class="row pl-3 pr-3"><div class="col-md-6 share-buttons"></div><div class="col-md-6 btn-improve-page"><a href=https://github.com/Olesp/olesp.github.io/edit/source/content/posts/Tutorials/Gathering%20all%20service%20accounts%20in%20AWS/gathering_svc_python.fr.md title="Améliorez cette page" target=_blank rel=noopener><i class="fas fa-code-branch"></i>Améliorez cette page</a></div></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/fr/posts/tutorials/introduction-to-kubernetes/get_started_with_k8s/ title="Introduction à Kubernetes" class="btn btn-outline-info"><div><i class="fas fa-chevron-circle-left"></i>Précédent</div><div class=next-prev-text>Introduction à Kubernetes</div></a></div></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a><div class="dropdown languageSelector"><a class="btn dropdown-toggle" href=# id=languageSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><img class=flag src=https://www.countryflags.io/fr/flat/16.png alt=fr>
Français</a><div class=dropdown-menu aria-labelledby=languageSelector><a class="dropdown-item nav-link languages-item" href=/posts/tutorials/gathering-all-service-accounts-in-aws/gathering_svc_python><img class=flag src=https://www.countryflags.io/gb/flat/24.png alt=gb>
English</a></div></div></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table des matières</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#pourquoi-collecter-tous-les-comptes-de-services-dans-un-compte-aws->Pourquoi collecter tous les comptes de services dans un compte AWS ?</a></li><li><a href=#comment-collecter-tous-les-comptes-de-services-dans-un-compte-aws-en-utilisant-python->Comment collecter tous les comptes de services dans un compte AWS en utilisant Python ?</a></li></ul></nav></div></div></section></div><footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://olivierlespagnon.com/fr/#about>À propos</a></li><li class=nav-item><a class=smooth-scroll href=https://olivierlespagnon.com/fr/#skills>Compétences</a></li><li class=nav-item><a class=smooth-scroll href=https://olivierlespagnon.com/fr/#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=https://olivierlespagnon.com/fr/#education>Education</a></li><li class=nav-item><a class=smooth-scroll href=https://olivierlespagnon.com/fr/#projects>Réalisations</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contactez moi :</h5><ul><li><span>Email:</span> <span>olespagnon@protonmail.com</span></li><li><span>Github:</span> <span>Olesp</span></li><li><span>Linkedin:</span> <span>olivierlespagnon</span></li></ul></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hossainemruz/toha target=_blank rel=noopener><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_2.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2021 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Alimenté par
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script type=text/javascript src=/js/jquery-3.4.1.min.js></script><script type=text/javascript src=/js/popper.min.js></script><script type=text/javascript src=/js/bootstrap.min.js></script><script type=text/javascript src=/js/navbar.js></script><script type=text/javascript src=/js/plyr.js></script><script type=text/javascript src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/js/single.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>