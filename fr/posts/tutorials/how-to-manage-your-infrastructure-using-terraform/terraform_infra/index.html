<!doctype html><html><head><title>Comment créer et gérer une infrastructure via Terraform</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link rel=stylesheet href=/css/flag-icon.min.css><link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/images/olivier_hu0e6c1c8c6dc6b67478684e7b00b46b4a_53705_42x0_resize_q75_box.jpeg><meta property="og:title" content="Comment créer et gérer une infrastructure via Terraform"><meta property="og:description" content="Utiliser Terraform"><meta property="og:type" content="article"><meta property="og:url" content="https://olivierlespagnon.com/fr/posts/tutorials/how-to-manage-your-infrastructure-using-terraform/terraform_infra/"><meta property="article:published_time" content="2023-02-13T08:06:25+06:00"><meta property="article:modified_time" content="2023-02-13T08:06:25+06:00"><meta name=description content="Utiliser Terraform"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css><link rel=stylesheet href=/css/style.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/fr>Olivier Lespagnon</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=languageSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span class="flag-icon flag-icon-fr"></span>Français</a><div class=dropdown-menu aria-labelledby=languageSelector><a class="dropdown-item nav-link languages-item" href=/posts/tutorials/how-to-manage-your-infrastructure-using-terraform/terraform_infra><span class="flag-icon flag-icon-gb"></span>English</a></div></li></ul></div></div></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/fr/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/fr/posts data-filter=all>Articles</a></li><div class=subtree><li><i class="fas fa-plus-circle"></i><a href>soft</a><ul><li><a href=/fr/posts/soft-skills/learn-a-new-job/learn_for_a_new_position/ title="Comment se former lors de la prise d'un nouveau poste">Comment se former lors de la prise d'un nouveau poste</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href>tech</a><ul><li><a href=/fr/posts/r%C3%A9alisations-techniques/hashicorp-vault/hashicorp_vault/ title="Hashicorp Vault">Hashicorp Vault</a></li></ul></li><li><i class="fas fa-minus-circle"></i><a class=active href>tuto</a><ul class=active><li><a class=active href=/fr/posts/tutorials/how-to-manage-your-infrastructure-using-terraform/terraform_infra/ title="Gérer votre infra avec Terraform">Gérer votre infra avec Terraform</a></li><li><a href=/fr/posts/tutorials/introduction-to-kubernetes/get_started_with_k8s/ title="Intro à K8S">Intro à K8S</a></li><li><a href=/fr/posts/tutorials/gathering-all-service-accounts-in-aws/gathering_svc_python/ title="Lister les comptes de service AWS">Lister les comptes de service AWS</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(https://olivierlespagnon.com/images/default-hero.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/olivier_hu0e6c1c8c6dc6b67478684e7b00b46b4a_53705_120x120_fit_q75_box.jpeg alt="Author Image"><h5 class=author-name>Olivier Lespagnon</h5><p>February 13, 2023</p></div><div class=title><h1>Comment créer et gérer une infrastructure via Terraform</h1></div><div class=post-content id=post-content><p>Si dans votre entreprise vous êtes amené à gérer des ressources sur le cloud où vous êtes sûrement déjà demandé comment faire pour maintenir un plan d&rsquo;architecture et vous assurer que cette dernière répond bien à vos spécifications. que faire si une de vos machines tombe, car de vos liens soit déconnecté, ou bien que vous ayez besoin de modifier rapidement les caractéristiques d&rsquo;une VM ou d&rsquo;un serveur. la solution miracle existe et elle s&rsquo;appelle terraform point avec terraform vous allez pouvoir en utilisant du code d&rsquo;écrire l&rsquo;infrastructure désirée peu importe le fournisseur de Cloud et d&rsquo;une simple commande la créer point terraform se chargera aussi de détecter les modifications et de ramener votre infrastructure au statut désiré.</p><h2 id=cest-quoi-terraform>C&rsquo;est quoi Terraform</h2><p>Terraform est un logiciel open source de gestion d&rsquo;infrastructure qui vous permet de manière sécurisée et prédictible de créer modifier et améliorer votre infrastructure. Il fait partie de la petite mais grandement appréciée famille des logiciels d’infrastructure as code, IAC pour les intimes. C&rsquo;est un logiciel créé par la société Hashicorp, La société qui se trouve aussi derrière Vault, Packer, Boundary ou bien Consul. Si vous travaillez dans l&rsquo;Haïti ou le cloud il est fort probable que vous ayez déjà entendu parler d&rsquo;eux ou même interagit avec un de leur logiciel. Grâce à
terraform vous pourrez gérer votre infrastructure via de simples fichiers de code et gérer ces derniers grâce à un outil de versioning comme dit et intégré tout ça dans une pipeline de CI/CD.</p><h2 id=comment-ça-marche->Comment ça marche ?</h2><p>Terraform repose sur un système de plugin. Chaque provider de service cloud dispose de son propre plugin, lequel permet d&rsquo;interagir avec l&rsquo;API du provider et de gérer des ressources. Par exemple, si je veux créer des VM sur AWS je peux utiliser le provider AWS et créer des ressources EC2, S3, route 53 et cetera.
<img src=/posts/R%c3%a9alisations%20techniques/How%20to%20manage%20your%20infrastructure%20using%20Terraform/images/design.png alt=Terraform class=center>
Selon la qualité du plugin de votre provider vous pourrez manager plus ou moins bien votre infrastructure. En plus de créer des ressources et de les modifier, Terraform gère aussi un objet qui l&rsquo;appelle le State point cet objet sert à faire le lien entre votre code et les ressources réelles créées dans le cloud. ça vous permettra de savoir à chaque modification de votre code quelles sont les différences entre l&rsquo;infrastructure réelle et l&rsquo;État que vous souhaitez. par exemple : si je crée un de ces deux sur AWS et que je le mets à disposition de collègues. Imaginons qu&rsquo;il prenne la liberté de modifier le type de machine que j&rsquo;ai créé. Lors de ma prochaine mise à jour du code de terraform, ce dernier m&rsquo;informera que la machine de C2 que j&rsquo;avais créé à l&rsquo;époque a été modifiée depuis et ne convient plus à la config que j&rsquo;avais donné. Il se chargera donc de la refaire passer à l&rsquo;état original. Un autre exemple, imaginons qu&rsquo;une de mes ressources n&rsquo;est plus disponible à cause d&rsquo;une panne, d&rsquo;une simple commande j&rsquo;aurais appliqué mon code terraform et ce dernier va régénérer la ressource pour moi.
Le workflow de terraform fonctionne en trois étapes:</p><ul><li>Write: vous définissez des ressources, qui peuvent s&rsquo;étendre entre différents fournisseurs de Cloud ou service. Par exemple Vous pourriez créer une configuration qui déploie une application sur des VM dans un réseau privé virtuel avec des groupes de sécurité associés et un équilibreur de charge</li><li>Plan: terraform créer un plan d&rsquo;exécution qui décrit l&rsquo;infrastructure qui sera créé modifier ou détruite basée sur l&rsquo;infrastructure existante déjà sauvegarder dans le State et votre configuration</li><li>Apply: lorsque vous vous approuvez, terraform effectuent les actions proposées lors de la planification dans l&rsquo;ordre correct en respectant les dépendances de vos ressources. Par exemple, si vous modifiez les propriétés d&rsquo;un réseau virtuel et changez le nombre de machines virtuelles dans ce réseau virtuel, terraform va recréer le VPC avant de modifier le nombre de machines virtuelles.</li></ul><img src=/posts/R%c3%a9alisations%20techniques/How%20to%20manage%20your%20infrastructure%20using%20Terraform/images/workflow.png alt=Terraform class=center><h2 id=créons-une-infrastructure-sur-aws>Créons une infrastructure sur AWS</h2><h3 id=prérequis>Prérequis</h3><ul><li>La CLI Terraform installée</li><li>La CLI AWS installée</li><li>Un compte AWS et ses identifiants</li></ul><p>Pour utiliser vos identifiants IAM afin de vous authentifier sur le provider AWS vous devrez paramétrer la variable d&rsquo;environnement <code>AWS_ACCESS_KEY_ID</code> et <code>AWS_SECRET_ACCESS_KEY</code></p><pre><code>export AWS_ACCESS_KEY_ID=&quot;YOURACCESSKEY&quot;
export AWS_SECRET_ACCESS_KEY=&quot;YOURSECRETKEY&quot;
</code></pre><h3 id=show-me-the-code>Show me the code</h3><p>Créer un dossier dans lequel vous stockez tous vos fichiers de configuration</p><pre><code>mkdir learn-terraform-aws-instance
</code></pre><p>Dans ce dossier créer un fichier appelé <code>main.tf</code></p><pre><code>terraform {
    required_providers {
        aws = {
            source  = &quot;hashicorp/aws&quot;
            version = &quot;4.54.0&quot;
        }
    }
}

provider &quot;aws&quot; {
    region  = &quot;eu-west-3&quot;
}

resource &quot;aws_instance&quot; &quot;app_server&quot; {
    ami           = &quot;ami-830c94e3&quot;
    instance_type = &quot;t2.micro&quot;

    tags = {
        Name = &quot;ExampleAppServerInstance&quot;
    }
}
</code></pre><h3 id=petite-traduction>Petite traduction</h3><h4 id=terraform-bloc>Terraform bloc</h4><p>Le bloc <code>terraform {}</code> contiens les paramètres requis par les plugins que nous utilisons pour créer l&rsquo;infra. Terraform installera les plugins configurés ici.
Dans cet exemple Terraform téléchargera le plugin AWS dans la version spécifiée.</p><h4 id=le-bloc-provider>Le bloc provider</h4><p>Le bloc d&rsquo;un provider sert à configurer ce dernier. Il contiendra la plupart du temps vos paramètres de connexion par exemple ou bien des configurations propres pour chaque provider. Ici dans le bloc <code>aws</code> on configure la région sur laquelle nous voulons déployer nos ressources.
Voici sa <a href=https://registry.terraform.io/providers/hashicorp/aws/latest/docs>documentation</a></p><h4 id=ressources>Ressources</h4><p>Le bloc ressource sert à créer et gérer une ressource sur le Cloud provider. Ici notre bloc nous permet de créer une instance AWS de type t2.micro et de choisir l&rsquo;image du système d&rsquo;exploitation que nous voulons y installer.
Pour plus d&rsquo;infos sur la configuration de ce bloc <a href=https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance>cliquez ici</a></p><h3 id=on-passe-aux-choses-sérieuses>On passe aux choses sérieuses</h3><p>Quand tout est prêt, vous pouvez initialiser votre dossier. Pour se faire, utilisez la commande <code>terraform init</code>.
Lors de l&rsquo;initialisation d&rsquo;un dossier, Terraform va installer les plugins configurés dans le bloc terraform vu plus haut.
Lorsque la commande finit son éxécution un dossier <code>.terraform</code> apparaît. Toutes les informations dont terraform à besoin pour fonctionner sont stockés dedans.</p><h4 id=quelques-bonnes-pratiques>Quelques bonnes pratiques</h4><p>Lorsque vous travaillez sur Terraform il est recommandé de formater son code et de valider qu&rsquo;il ne contient pas d&rsquo;erreurs avant de passer à la suite. Pour cela il existe deux commandes que vous devriez utiliser de manière automatique :</p><pre><code>terraform fmt
terraform validate
</code></pre><p>La première detecte le mauvais formattage de votre code et corrige les erreurs. La seconde permet de vérifier qu&rsquo;il n&rsquo;y a pas d&rsquo;incohérences dans votre code et vous avertit par un <code>Success! The configuration is valid.</code></p><h4 id=apply-it->Apply it !</h4><p>Maintenant que tout est bon on peut y aller.
Rentrons la commande suivante :</p><pre><code>terraform apply
</code></pre><p>Vous devriez voir apparaître quelque chose comme ça sur votre terminal</p><pre><code>Terraform used the selected providers to generate the following execution plan.
Resource actions are indicated with the following symbols:
+ create

Terraform will perform the following actions:

aws_instance.app_server will be created
+ resource &quot;aws_instance&quot; &quot;app_server&quot; {
    + ami                          = &quot;ami-830c94e3&quot;
    + arn                          = (known after apply)
#...

Plan: 1 to add, 0 to change, 0 to destroy.

Do you want to perform these actions?
Terraform will perform the actions described above.
Only 'yes' will be accepted to approve.

Enter a value:
</code></pre><p>Si vous observez bien vous verrez que terraform propose de créer une ressources <code>Plan: 1 to add, 0 to change, 0 to destroy.</code>
Et juste au dessus, chaque ligne commence soit par un + ou un - ou même un ~<br>Les <code>+</code> indiquent une création de ressources.<br>Les <code>-</code> indiquent une suppression de ressources.<br>Et les <code>~</code> indiquent qu&rsquo;une ressources a été modifiée depuis le dernier <code>terraform apply</code><br>Tout est bon il ne reste plus qu&rsquo;a entrer <code>yes</code> pour valider et créer les ressources.</p><p>Et voilà. Vous avez créer votre première infra avec Terraform.
Pour tout supprimer il ne vous reste qu&rsquo;à taper <code>terraform delete</code> pour effacer toutes traces.
Si vous avez déjà fait ce genre d&rsquo;opérations à la main, vous réalisez surement à quel point Terraform peut être utile.
Ce sera un atout de poid dans la gestion de votre infra.</p></div><div class="row pl-3 pr-3"><div class="col-md-6 share-buttons"></div><div class="col-md-6 btn-improve-page"><a href=https://github.com/Olesp/olesp.github.io/edit/source/content/posts/Tutorials/How%20to%20manage%20your%20infrastructure%20using%20Terraform/terraform_infra.fr.md title="Améliorez cette page" target=_blank rel=noopener><i class="fas fa-code-branch"></i>Améliorez cette page</a></div></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/fr/posts/r%C3%A9alisations-techniques/hashicorp-vault/hashicorp_vault/ title="Implémentation d'un gestionnaire de secrets dynamiques" class="btn btn-outline-info"><div><i class="fas fa-chevron-circle-left"></i>Précédent</div><div class=next-prev-text>Implémentation d'un gestionnaire de secrets dynamiques</div></a></div><div class="col-md-6 next-article"><a href=/fr/posts/tutorials/introduction-to-kubernetes/get_started_with_k8s/ title="Introduction à Kubernetes" class="btn btn-outline-info"><div>Suivant <i class="fas fa-chevron-circle-right"></i></div><div class=next-prev-text>Introduction à Kubernetes</div></a></div></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a><div class="dropdown languageSelector"><a class="btn dropdown-toggle" href=# id=languageSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><img class=flag src=https://www.countryflags.io/fr/flat/16.png alt=fr>
Français</a><div class=dropdown-menu aria-labelledby=languageSelector><a class="dropdown-item nav-link languages-item" href=/posts/tutorials/how-to-manage-your-infrastructure-using-terraform/terraform_infra><img class=flag src=https://www.countryflags.io/gb/flat/24.png alt=gb>
English</a></div></div></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table des matières</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#cest-quoi-terraform>C&rsquo;est quoi Terraform</a></li><li><a href=#comment-ça-marche->Comment ça marche ?</a></li><li><a href=#créons-une-infrastructure-sur-aws>Créons une infrastructure sur AWS</a><ul><li><a href=#prérequis>Prérequis</a></li><li><a href=#show-me-the-code>Show me the code</a></li><li><a href=#petite-traduction>Petite traduction</a><ul><li><a href=#terraform-bloc>Terraform bloc</a></li><li><a href=#le-bloc-provider>Le bloc provider</a></li><li><a href=#ressources>Ressources</a></li></ul></li><li><a href=#on-passe-aux-choses-sérieuses>On passe aux choses sérieuses</a><ul><li><a href=#quelques-bonnes-pratiques>Quelques bonnes pratiques</a></li><li><a href=#apply-it->Apply it !</a></li></ul></li></ul></li></ul></nav></div></div></section></div><footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://olivierlespagnon.com/fr/#about>À propos</a></li><li class=nav-item><a class=smooth-scroll href=https://olivierlespagnon.com/fr/#skills>Compétences</a></li><li class=nav-item><a class=smooth-scroll href=https://olivierlespagnon.com/fr/#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=https://olivierlespagnon.com/fr/#education>Education</a></li><li class=nav-item><a class=smooth-scroll href=https://olivierlespagnon.com/fr/#projects>Réalisations</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contactez moi :</h5><ul><li><span>Email:</span> <span>olespagnon@protonmail.com</span></li><li><span>Github:</span> <span>Olesp</span></li><li><span>Linkedin:</span> <span>olivierlespagnon</span></li></ul></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hossainemruz/toha target=_blank rel=noopener><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_2.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2021 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Alimenté par
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script type=text/javascript src=/js/jquery-3.4.1.min.js></script><script type=text/javascript src=/js/popper.min.js></script><script type=text/javascript src=/js/bootstrap.min.js></script><script type=text/javascript src=/js/navbar.js></script><script type=text/javascript src=/js/plyr.js></script><script type=text/javascript src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/js/single.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>