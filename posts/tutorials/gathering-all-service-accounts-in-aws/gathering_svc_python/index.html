<!doctype html><html><head><title>Gathering all your service accounts on AWS</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link rel=stylesheet href=/css/flag-icon.min.css><link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/images/olivier_hu0e6c1c8c6dc6b67478684e7b00b46b4a_53705_42x0_resize_q75_box.jpeg><meta property="og:title" content="Gathering all your service accounts on AWS"><meta property="og:description" content="Gathering service accounts"><meta property="og:type" content="article"><meta property="og:url" content="https://olivierlespagnon.com/posts/tutorials/gathering-all-service-accounts-in-aws/gathering_svc_python/"><meta property="article:published_time" content="2023-02-13T08:06:25+06:00"><meta property="article:modified_time" content="2023-02-13T08:06:25+06:00"><meta name=description content="Gathering service accounts"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css><link rel=stylesheet href=/css/style.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/>Olivier Lespagnon</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=languageSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span class="flag-icon flag-icon-gb"></span>English</a><div class=dropdown-menu aria-labelledby=languageSelector><a class="dropdown-item nav-link languages-item" href=/fr/posts/tutorials/gathering-all-service-accounts-in-aws/gathering_svc_python><span class="flag-icon flag-icon-fr"></span>Français</a></div></li></ul></div></div></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><i class="fas fa-plus-circle"></i><a href=/posts/r%C3%A9alisations-techniques/>Réalisations techniques</a><ul><li><a href=/posts/r%C3%A9alisations-techniques/create-and-host-a-static-website-using-github-actions/github_website/ title="Create a static website">Create a static website</a></li><li><a href=/posts/r%C3%A9alisations-techniques/deploy-dependency-track/deploying-dependency-track/ title="Deploy Dependency Track">Deploy Dependency Track</a></li><li><a href=/posts/r%C3%A9alisations-techniques/hashicorp-vault/hashicorp_vault/ title="Hashicorp Vault">Hashicorp Vault</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/soft-skills/>Soft skills</a><ul><li><a href=/posts/soft-skills/learn-a-new-job/learn_for_a_new_position/ title="How to train when taking on a new position">How to train when taking on a new position</a></li></ul></li><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/tutorials/>Tutorials</a><ul class=active><li><a class=active href=/posts/tutorials/gathering-all-service-accounts-in-aws/gathering_svc_python/ title="Gathering service accounts">Gathering service accounts</a></li><li><a href=/posts/tutorials/introduction-to-kubernetes/get_started_with_k8s/ title="Intro to K8S">Intro to K8S</a></li><li><a href=/posts/tutorials/how-to-manage-your-infrastructure-using-terraform/terraform_infra/ title="Manage your infra with Terraform">Manage your infra with Terraform</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(https://olivierlespagnon.com/images/default-hero.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/olivier_hu0e6c1c8c6dc6b67478684e7b00b46b4a_53705_120x120_fit_q75_box.jpeg alt="Author Image"><h5 class=author-name>Olivier Lespagnon</h5><p>February 13, 2023</p></div><div class=title><h1>Gathering all your service accounts on AWS</h1></div><div class=post-content id=post-content><p>Gathering all services account in an AWS account is an important task for any organization that uses Amazon Web Services (AWS). This task involves retrieving information about all the services that are being used in an AWS account and aggregating it into a single location for better management and monitoring. This can be especially useful for organizations that have multiple AWS accounts and want to centralize their management and monitoring.</p><h2 id=why-gather-all-services-account-in-an-aws-account>Why gather all services account in an AWS account?</h2><p>There are several benefits to gathering all services account in an AWS account, including:</p><ul><li>Improved visibility: By aggregating all services into a single location, organizations can get a better understanding of what services they are using and how they are being used. This helps to identify any areas where the services are not being used effectively or where there may be cost optimization opportunities.</li><li>Better cost management: By having a clear view of all services, organizations can better manage their costs by identifying and removing any unused services or optimizing the usage of existing services.</li><li>Improved security: Having all services in one place makes it easier to monitor and secure them. This helps to identify any potential security risks and to ensure that all services are being used in a secure and compliant manner.</li></ul><h2 id=how-to-gather-all-services-account-in-an-aws-account-using-python>How to gather all services account in an AWS account using Python?</h2><p>Gathering all services account in an AWS account can be done using the AWS Management Console or through the AWS CLI. However, many organizations prefer to use Python to automate this process, as it provides a more flexible and scalable solution. The following steps outline how to gather all services account in an AWS account using Python. In this example, we will consider that every account not used by human do not contain email addresses as username.</p><ol><li>Set up an AWS account: Before you can gather all services in an AWS account, you need to have an AWS account. If you don&rsquo;t already have one, you can sign up for an AWS account on the AWS website.</li><li>Install the AWS CLI and Python: To gather all services in an AWS account, you will need to install the AWS CLI and Python. The AWS CLI is a command line tool that allows you to interact with AWS services from the command line, and Python is a high-level programming language that is widely used for automation and scripting tasks.</li><li>Configure the AWS CLI: After installing the AWS CLI, you need to configure it with your AWS account credentials. This can be done by running the &ldquo;aws configure&rdquo; command and providing your AWS access key ID, secret access key, and default region.</li><li>Install the boto3 library: To gather all services in an AWS account using Python, you will need to use the boto3 library. Boto3 is the AWS SDK for Python, and it allows you to interact with AWS services from within Python. You can install boto3 by running the following command: <code>pip install boto3</code>.</li><li>Write a Python script: After installing boto3, you are ready to write a Python script to gather all service acccounts in your AWS account. The following is an example of a Python script that retrieves information about all the services in an AWS account and prints it to the console:</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>    <span style=color:#f92672>import</span> boto3
    <span style=color:#f92672>import</span> pandas <span style=color:#f92672>as</span> pd

    <span style=color:#75715e># Connect to AWS Organizations service</span>
    client <span style=color:#f92672>=</span> boto3<span style=color:#f92672>.</span>client(<span style=color:#e6db74>&#39;organizations&#39;</span>)

    <span style=color:#75715e># Get a list of all AWS accounts in the organization</span>
    response <span style=color:#f92672>=</span> client<span style=color:#f92672>.</span>list_accounts()
    accounts <span style=color:#f92672>=</span> response[<span style=color:#e6db74>&#39;Accounts&#39;</span>]

    <span style=color:#75715e># Filter out the accounts that do not have an email address as a username</span>
    filtered_accounts <span style=color:#f92672>=</span> []
    <span style=color:#66d9ef>for</span> account <span style=color:#f92672>in</span> accounts:
        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;@&#39;</span> <span style=color:#f92672>in</span> account[<span style=color:#e6db74>&#39;Account Name&#39;</span>]:
            filtered_accounts<span style=color:#f92672>.</span>append(account)

    <span style=color:#75715e># Initialize an empty Pandas dataframe to store the data for each account</span>
    data <span style=color:#f92672>=</span> []
    columns <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;Account Id&#39;</span>, <span style=color:#e6db74>&#39;Account Name&#39;</span>, <span style=color:#e6db74>&#39;Email&#39;</span>]
    <span style=color:#66d9ef>for</span> account <span style=color:#f92672>in</span> filtered_accounts:
        data<span style=color:#f92672>.</span>append([account[<span style=color:#e6db74>&#39;Id&#39;</span>], account[<span style=color:#e6db74>&#39;Name&#39;</span>], account[<span style=color:#e6db74>&#39;Email&#39;</span>]])

    df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame(data, columns<span style=color:#f92672>=</span>columns)

    <span style=color:#75715e># Save the results to an Excel file</span>
    df<span style=color:#f92672>.</span>to_excel(<span style=color:#e6db74>&#39;accounts.xlsx&#39;</span>, index<span style=color:#f92672>=</span>False)

</code></pre></div><p>This code enables you to save alld the service accounts in your organization and save them to an excel for reporting.</p></div><div class="row pl-3 pr-3"><div class="col-md-6 share-buttons"></div><div class="col-md-6 btn-improve-page"><a href=https://github.com/Olesp/olesp.github.io/edit/source/content/posts/Tutorials/Gathering%20all%20service%20accounts%20in%20AWS/gathering_svc_python.en.md title="Improve this page" target=_blank rel=noopener><i class="fas fa-code-branch"></i>Improve this page</a></div></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/soft-skills/learn-a-new-job/learn_for_a_new_position/ title="How to train when taking on a new position" class="btn btn-outline-info"><div><i class="fas fa-chevron-circle-left"></i>Prev</div><div class=next-prev-text>How to train when taking on a new position</div></a></div><div class="col-md-6 next-article"><a href=/posts/tutorials/introduction-to-kubernetes/get_started_with_k8s/ title="Introduction to Kubernetes" class="btn btn-outline-info"><div>Next <i class="fas fa-chevron-circle-right"></i></div><div class=next-prev-text>Introduction to Kubernetes</div></a></div></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a><div class="dropdown languageSelector"><a class="btn dropdown-toggle" href=# id=languageSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><img class=flag src=https://www.countryflags.io/gb/flat/16.png alt=gb>
English</a><div class=dropdown-menu aria-labelledby=languageSelector><a class="dropdown-item nav-link languages-item" href=/fr/posts/tutorials/gathering-all-service-accounts-in-aws/gathering_svc_python><img class=flag src=https://www.countryflags.io/fr/flat/24.png alt=fr>
Français</a></div></div></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#why-gather-all-services-account-in-an-aws-account>Why gather all services account in an AWS account?</a></li><li><a href=#how-to-gather-all-services-account-in-an-aws-account-using-python>How to gather all services account in an AWS account using Python?</a></li></ul></nav></div></div></section></div><footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://olivierlespagnon.com/#about>About</a></li><li class=nav-item><a class=smooth-scroll href=https://olivierlespagnon.com/#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=https://olivierlespagnon.com/#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=https://olivierlespagnon.com/#education>Education</a></li><li class=nav-item><a class=smooth-scroll href=https://olivierlespagnon.com/#projects>Achievements</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><span>Email:</span> <span>olespagnon@protonmail.com</span></li><li><span>Github:</span> <span>Olesp</span></li><li><span>Linkedin:</span> <span>olivierlespagnon</span></li></ul></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hossainemruz/toha target=_blank rel=noopener><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_2.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2021 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script type=text/javascript src=/js/jquery-3.4.1.min.js></script><script type=text/javascript src=/js/popper.min.js></script><script type=text/javascript src=/js/bootstrap.min.js></script><script type=text/javascript src=/js/navbar.js></script><script type=text/javascript src=/js/plyr.js></script><script type=text/javascript src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/js/single.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>