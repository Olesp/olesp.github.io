<!doctype html><html><head><title>How to create and manage your infrastructure using Terraform</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link rel=stylesheet href=/css/flag-icon.min.css><link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/images/olivier_hu0e6c1c8c6dc6b67478684e7b00b46b4a_53705_42x0_resize_q75_box.jpeg><meta property="og:title" content="How to create and manage your infrastructure using Terraform"><meta property="og:description" content="Using Terraform"><meta property="og:type" content="article"><meta property="og:url" content="https://olivierlespagnon.com/posts/tutorials/how-to-manage-your-infrastructure-using-terraform/terraform_infra/"><meta property="article:published_time" content="2022-06-05T08:06:25+06:00"><meta property="article:modified_time" content="2022-06-05T08:06:25+06:00"><meta name=description content="Using Terraform"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css><link rel=stylesheet href=/css/style.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/>Olivier Lespagnon</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=languageSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span class="flag-icon flag-icon-gb"></span>English</a><div class=dropdown-menu aria-labelledby=languageSelector><a class="dropdown-item nav-link languages-item" href=/fr/posts/tutorials/how-to-manage-your-infrastructure-using-terraform/terraform_infra><span class="flag-icon flag-icon-fr"></span>Français</a></div></li></ul></div></div></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><i class="fas fa-plus-circle"></i><a href=/posts/r%C3%A9alisations-techniques/>Réalisations techniques</a><ul><li><a href=/posts/r%C3%A9alisations-techniques/hashicorp-vault/hashicorp_vault/ title="Hashicorp Vault">Hashicorp Vault</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/soft-skills/>Soft skills</a><ul><li><a href=/posts/soft-skills/learn-a-new-job/learn_for_a_new_position/ title="How to train when taking on a new position">How to train when taking on a new position</a></li></ul></li><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/tutorials/>Tutorials</a><ul class=active><li><a href=/posts/tutorials/gathering-all-service-accounts-in-aws/gathering_svc_python/ title="Gathering service accounts">Gathering service accounts</a></li><li><a href=/posts/tutorials/introduction-to-kubernetes/get_started_with_k8s/ title="Intro to K8S">Intro to K8S</a></li><li><a class=active href=/posts/tutorials/how-to-manage-your-infrastructure-using-terraform/terraform_infra/ title="Manage your infra with Terraform">Manage your infra with Terraform</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(https://olivierlespagnon.com/images/default-hero.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/olivier_hu0e6c1c8c6dc6b67478684e7b00b46b4a_53705_120x120_fit_q75_box.jpeg alt="Author Image"><h5 class=author-name>Olivier Lespagnon</h5><p>June 5, 2022</p></div><div class=title><h1>How to create and manage your infrastructure using Terraform</h1></div><div class=post-content id=post-content><p>If in your company you have to manage resources on the cloud where you have surely already wondered how to maintain an architecture plan and ensure that it meets your specifications. what to do if one of your machines goes down, because your links are disconnected, or you need to quickly modify the characteristics of a VM or a server. the miracle solution exists and it&rsquo;s called terraform point with terraform you will be able to use code to write the desired infrastructure regardless of the cloud provider and with a simple command create it terraform point will also detect changes and bring your infrastructure back to the desired status.</p><h2 id=what-is-terraform>What is Terraform</h2><p>Terraform is an open source infrastructure management software that allows you to create, change and improve your infrastructure in a secure and predictable way. It is part of the small but greatly appreciated family of infrastructure as code software, IAC for short. It is a software created by the company Hashicorp, the company which is also behind Vault, Packer, Boundary or Consul. If you work in Haiti or the cloud chances are you have heard of them before or even interacted with one of their software. Thanks to
terraform you will be able to manage your infrastructure via simple code files and manage them thanks to a versioning tool as said and integrated all that into a CI/CD pipeline.</p><h2 id=how-it-works->How it works ?</h2><p>Terraform is based on a plugin system. Each cloud service provider has its own plugin, which allows you to interact with the provider&rsquo;s API and manage resources. For example, if I want to create VMs on AWS I can use the AWS provider and create EC2, S3, route 53 resources and so on.
<img src=/posts/R%c3%a9alisations%20techniques/How%20to%20manage%20your%20infrastructure%20using%20Terraform/images/design.png alt=Terraform class=center>
Depending on the quality of your provider&rsquo;s plugin, you can manage your infrastructure more or less well. In addition to creating resources and modifying them, Terraform also manages an object which calls it the State point this object is used to make the link between your code and the real resources created in the cloud. it will allow you to know at each modification of your code what are the differences between the real infrastructure and the state you want. for example: if I create one of these two on AWS and make it available to colleagues. Suppose he takes the liberty of modifying the type of machine I have created. During my next update of the terraform code, the latter will inform me that the C2 machine that I had created at the time has since been modified and no longer suits the config that I had given. He will therefore take care of restoring it to the original state. Another example, let&rsquo;s imagine that one of my resources is no longer available due to a breakdown, with a simple command I would have applied my terraform code and the latter will regenerate the resource for me.
The terraform workflow works in three steps:</p><ul><li>Write: you define resources, which can span across different cloud or service providers. For example You could create a configuration that deploys an application to VMs in a virtual private network with associated security groups and a load balancer</li><li>Plan: terraform create an execution plan that describes the infrastructure that will be created modify or destroy based on the existing infrastructure already saved in the State and your configuration</li><li>Apply: when you approve yourself, terraform performs the actions proposed during the schedule in the correct order respecting the dependencies of your resources. For example, if you modify the properties of a virtual network and change the number of virtual machines in this virtual network, terraform will recreate the VPC before modifying the number of virtual machines.</li></ul><img src=/posts/R%c3%a9alisations%20techniques/How%20to%20manage%20your%20infrastructure%20using%20Terraform/images/workflow.png alt=Terraform class=center><h2 id=lets-create-an-infrastructure-on-aws>Let&rsquo;s create an infrastructure on AWS</h2><h3 id=prerequisites>Prerequisites</h3><ul><li>The Terraform CLI installed</li><li>The AWS CLI installed</li><li>An AWS account and its credentials</li></ul><p>To use your IAM credentials to authenticate on the AWS provider you will need to set the environment variable<code>AWS_ACCESS_KEY_ID</code> And<code>AWS_SECRET_ACCESS_KEY</code></p><pre><code>export AWS_ACCESS_KEY_ID=&quot;YOURACCESSKEY&quot;
export AWS_SECRET_ACCESS_KEY=&quot;YOURSECRETKEY&quot;
</code></pre><h3 id=show-me-the-code>Show me the code</h3><p>Create a folder where you store all your configuration files</p><pre><code>mkdir learn-terraform-aws-instance
</code></pre><p>In this folder create a file called<code>main.tf</code></p><pre><code>terraform {
    required_providers {
        aws = {
            source  = &quot;hashicorp/aws&quot;
            version = &quot;4.54.0&quot;
        }
    }
}


provider &quot;aws&quot; {
    region  = &quot;eu-west-3&quot;
}


resource &quot;aws_instance&quot; &quot;app_server&quot; {
    ami = &quot;ami-830c94e3&quot;
    instance_type = &quot;t2.micro&quot;


    tags = {
        Name = &quot;ExampleAppServerInstance&quot;
    }
}
</code></pre><h3 id=short-translation>Short translation</h3><h4 id=terraform-bloc>Terraform bloc</h4><p>The block<code>terraform {}</code> contains the parameters required by the plugins we use to create the infra. Terraform will install the plugins configured here.
In this example Terraform will download the AWS plugin in the specified version.</p><h4 id=the-provider-block>The provider block</h4><p>The block of a provider is used to configure the latter. It will most of the time contain your connection parameters, for example, or specific configurations for each provider. Here in the block<code>aws</code> we configure the region on which we want to deploy our resources.
Here is his <a href=https://registry.terraform.io/providers/hashicorp/aws/latest/docs>documentation</a></p><h4 id=resources>Resources</h4><p>The resource block is used to create and manage a resource on the Cloud provider. Here our block allows us to create an AWS instance of type t2.micro and to choose the image of the operating system that we want to install on it.
For more info on configuring this block <a href=https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance>Click here</a></p><h3 id=lets-get-down-to-business>Let&rsquo;s get down to business</h3><p>When everything is ready, you can initialize your file. To do so, use the command<code>terraform init</code>.
When initializing a folder, Terraform will install the plugins configured in the terraform block seen above.
When the command finishes its execution a folder<code>.terraform</code> appears. All the information terraform needs to function is stored in it.</p><h4 id=some-best-practices>Some best practices</h4><p>When you work on Terraform it is recommended to format your code and validate that it does not contain errors before moving on. For this there are two commands that you should use automatically:</p><pre><code>terraform fmt
terraform validate
</code></pre><p>The first detects bad formatting in your code and fixes errors. The second checks that there is no inconsistency in your code and warns you with a<code>Success! The configuration is valid.</code></p><h4 id=apply-it->Apply it !</h4><p>Now that everything is good we can go.
Let&rsquo;s enter the following command:</p><pre><code>terraform apply
</code></pre><p>You should see something like this appear on your terminal</p><pre><code>Terraform used the selected providers to generate the following execution plan.
Resource actions are indicated with the following symbols:
+ create


Terraform will perform the following actions:


aws_instance.app_server will be created
+ resource &quot;aws_instance&quot; &quot;app_server&quot; {
    +ami=&quot;ami-830c94e3&quot;
    + arn                          = (known after apply)
#...


Plan: 1 to add, 0 to change, 0 to destroy.


Do you want to perform these actions?
Terraform will perform the actions described above.
Only 'yes' will be accepted to approve.


Enter a value:
</code></pre><p>If you look closely you will see that terraform offers to create a resource<code>Plan: 1 to add, 0 to change, 0 to destroy.</code>
And just above, each line starts with either a + or a - or even a ~
THE<code>+</code> indicates resource creation.
THE<code>-</code> indicate resource removal.
And the<code>~</code> indicate that a resource has been modified since the last<code>terraform apply</code><br>Everything is good, all you have to do is enter<code>yes</code> to validate and create the resources.</p><p>And There you go. You have created your first infra with Terraform.
To delete everything, all you have to do is type<code>terraform delete</code> to erase all traces.
If you have ever done this kind of operation by hand, you surely realize how useful Terraform can be.
It will be a major asset in the management of your infrastructure.</p></div><div class="row pl-3 pr-3"><div class="col-md-6 share-buttons"></div><div class="col-md-6 btn-improve-page"><a href=https://github.com/Olesp/olesp.github.io/edit/source/content/posts/Tutorials/How%20to%20manage%20your%20infrastructure%20using%20Terraform/terraform_infra.en.md title="Improve this page" target=_blank rel=noopener><i class="fas fa-code-branch"></i>Improve this page</a></div></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/tutorials/introduction-to-kubernetes/get_started_with_k8s/ title="Introduction to Kubernetes" class="btn btn-outline-info"><div><i class="fas fa-chevron-circle-left"></i>Prev</div><div class=next-prev-text>Introduction to Kubernetes</div></a></div></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a><div class="dropdown languageSelector"><a class="btn dropdown-toggle" href=# id=languageSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><img class=flag src=https://www.countryflags.io/gb/flat/16.png alt=gb>
English</a><div class=dropdown-menu aria-labelledby=languageSelector><a class="dropdown-item nav-link languages-item" href=/fr/posts/tutorials/how-to-manage-your-infrastructure-using-terraform/terraform_infra><img class=flag src=https://www.countryflags.io/fr/flat/24.png alt=fr>
Français</a></div></div></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#what-is-terraform>What is Terraform</a></li><li><a href=#how-it-works->How it works ?</a></li><li><a href=#lets-create-an-infrastructure-on-aws>Let&rsquo;s create an infrastructure on AWS</a><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#show-me-the-code>Show me the code</a></li><li><a href=#short-translation>Short translation</a><ul><li><a href=#terraform-bloc>Terraform bloc</a></li><li><a href=#the-provider-block>The provider block</a></li><li><a href=#resources>Resources</a></li></ul></li><li><a href=#lets-get-down-to-business>Let&rsquo;s get down to business</a><ul><li><a href=#some-best-practices>Some best practices</a></li><li><a href=#apply-it->Apply it !</a></li></ul></li></ul></li></ul></nav></div></div></section></div><footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://olivierlespagnon.com/#about>About</a></li><li class=nav-item><a class=smooth-scroll href=https://olivierlespagnon.com/#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=https://olivierlespagnon.com/#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=https://olivierlespagnon.com/#education>Education</a></li><li class=nav-item><a class=smooth-scroll href=https://olivierlespagnon.com/#projects>Achievements</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><span>Email:</span> <span>olespagnon@protonmail.com</span></li><li><span>Github:</span> <span>Olesp</span></li><li><span>Linkedin:</span> <span>olivierlespagnon</span></li></ul></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hossainemruz/toha target=_blank rel=noopener><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_2.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2021 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script type=text/javascript src=/js/jquery-3.4.1.min.js></script><script type=text/javascript src=/js/popper.min.js></script><script type=text/javascript src=/js/bootstrap.min.js></script><script type=text/javascript src=/js/navbar.js></script><script type=text/javascript src=/js/plyr.js></script><script type=text/javascript src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/js/single.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>